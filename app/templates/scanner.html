{% extends "base.html" %}

{% block content %}
    <h2>Сканнер</h2>
    <div style="display: flex; gap: 20px;">
        <!-- Видеопоток -->
        <div style="flex: 2;">
            <img src="{{ url_for('video_feed') }}" alt="Video Feed" style="width: 100%; max-width: 640px;">
        </div>
        
        <!-- Логи -->
        <div id="log-container" style="flex: 1; background: #1e1e1e; color: #fff; padding: 10px; height: 480px; overflow-y: auto;">
            <!-- Кнопка "Следовать за логами" -->
            <div style="position: sticky; top: 0; background: #333; padding: 5px; z-index: 1;">
                <button onclick="enableAutoScroll()">
                    Следовать за логами <span id="auto-scroll-status">(вкл)</span>
                </button>
            </div>
            
            <!-- Контейнер для логов -->
            <pre id="logs" style="font-family: monospace; margin: 0; white-space: pre-wrap;"></pre>
        </div>
    </div>

    <script>
        const logContainer = document.getElementById('log-container');
        const logElement = document.getElementById('logs');
        const eventSource = new EventSource('/log_stream');
        const autoScrollStatus = document.getElementById('auto-scroll-status');
        
        let autoScroll = true;  // Флаг для автоматической прокрутки

        // Обработчик новых логов
        eventSource.onmessage = function(e) {
            // Добавляем новую строку
            logElement.insertAdjacentHTML('beforeend', e.data + '\n');
            
            // Прокручиваем вниз, если включен автоскролл
            if (autoScroll) {
                logContainer.scrollTo({
                    top: logContainer.scrollHeight,
                    behavior: 'smooth'
                });
            }
        };

        // Отслеживаем ручную прокрутку
        logContainer.addEventListener('scroll', () => {
            autoScroll = logContainer.scrollTop + logContainer.clientHeight >= logContainer.scrollHeight - 50;
            autoScrollStatus.textContent = autoScroll ? '(вкл)' : '(выкл)';
        });

        // Включаем автоскролл при нажатии на кнопку
        function enableAutoScroll() {
            autoScroll = true;
            logContainer.scrollTo({
                top: logContainer.scrollHeight,
                behavior: 'smooth'
            });
        }
    </script>
{% endblock %}